<div class="space-y-4">
  <div class="prose prose-sm text-secondary">
    <p class="text-primary font-medium"><%= t('.setup_instructions') %></p>
    <ol>
      <li><%= t('.step_1') %></li>
      <li><%= t('.step_2') %></li>
      <li><%= t('.step_3') %></li>
    </ol>

    <p class="text-primary font-medium"><%= t('.field_descriptions') %></p>
    <ul>
      <li><strong><%= t('.name_label') %>:</strong> <%= t('.name_description') %></li>
      <li><strong><%= t('.login_label') %>:</strong> <%= t('.login_description') %></li>
      <li><strong><%= t('.password_label') %>:</strong> <%= t('.password_description') %></li>
    </ul>
  </div>

  <% if defined?(@error_message) && @error_message.present? %>
    <div class="p-2 rounded-md bg-destructive/10 text-destructive text-sm">
      <%= @error_message %>
    </div>
  <% end %>

  <%= styled_form_with model: @priorbank_item || PriorbankItem.new,
                       url: priorbank_items_path,
                       scope: :priorbank_item,
                       method: :post,
                       data: { turbo: true },
                       class: "space-y-3" do |form| %>
    <%= form.text_field :name,
                        label: t('.name_label'),
                        placeholder: t('.name_placeholder') %>

    <%= form.text_field :login,
                        label: t('.login_label'),
                        placeholder: t('.login_placeholder') %>

    <%= form.text_field :password,
                        label: t('.password_label'),
                        placeholder: t('.password_placeholder'),
                        type: :password %>

    <div class="flex justify-end">
      <%= form.submit t('.save_button'),
                      class: "inline-flex items-center justify-center rounded-lg px-4 py-2 text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 transition-colors" %>
    </div>
  <% end %>

  <% if @priorbank_items&.any? %>
    <div class="space-y-3 mt-4">
      <div class="flex items-center gap-2">
        <div class="w-2 h-2 bg-success rounded-full"></div>
        <p class="text-sm text-secondary"><%= t('.configured_message', accounts_link: link_to(t('accounts.index.title', default: 'Accounts'), accounts_path, class: 'link')).html_safe %></p>
      </div>

      <div class="space-y-2">
        <% @priorbank_items.each do |item| %>
          <div class="flex items-center justify-between p-3 bg-container border border-secondary rounded-lg">
            <div class="flex-1">
              <p class="text-sm font-medium text-primary"><%= item.name %></p>
              <p class="text-xs text-secondary"><%= t('.login_display', login: item.login&.first(4)) %></p>

            </div>
            <% if item.scheduled_for_deletion %>
              <p class="text-xs text-warning mt-1"><%= t('.scheduled_for_deletion') %></p>
            <% else %>
              <div class="flex items-center gap-2">
                <%= button_to priorbank_item_path(item),
                              method: :delete,
                              disabled: item.scheduled_for_deletion,
                              class: "text-sm text-destructive hover:underline",
                              data: { turbo: true, turbo_confirm: t('.delete_confirm') } do %>
                  <%= icon "trash-2", class: "w-5 h-5 text-destructive" %>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="text-sm text-secondary"><%= t('.no_connections') %></div>
  <% end %>
</div>
